import{R as U}from"./router-CL2ta_jh.js";const he=Symbol(),ee=function(e){try{return e(...[].slice.call(arguments,1))}catch(t){return setTimeout(()=>{throw t}),t instanceof Error?t:t=new Error(t)}};function $(e,t){if(e)throw new Error(`Reatom error: ${t}`)}const W=e=>e?.__reatom!==void 0,B=e=>e.subs.size+e.listeners.size>0;function se(e){$(typeof e!="function",`invalid "${typeof e}", function expected`)}const pe=e=>e.cause===null?e:pe(e.cause),Ae=()=>typeof window=="object"&&typeof document=="object";let J,Oe=0;const ct=({callLateEffect:e=ee,callNearEffect:t=ee,restrictMultipleContexts:n=Ae()}={})=>{n&&Oe++==1&&console.warn("Reatom: multiple contexts detected, which is irrelevant in browser, you should use only one context");let o=new WeakMap,s=h=>o.get(h),c=new Set,r=[],a=[],u=!1,d=null,g=[],m=[],p=[],C=0,O=0,y=!1,H=()=>{for(let h of r)t(h,I);r=[]},_=()=>{if(!y){y=!0,H();for(let h of a)e(h,I),r.length>0&&H();a=[],y=!1}},b=({state:h,proto:l,pubs:w,subs:i,listeners:f},v)=>(l.actual=!1,p.push(l.patch={state:h,proto:l,cause:v,pubs:w,subs:i,listeners:f}),l.patch),S=h=>{for(let l of h.subs){let w=l.patch??s(l);l.patch&&!l.actual||b(w,h).listeners.size===0&&S(w)}},L=(h,l)=>{if(l.subs.delete(h)&&(m.push(()=>l.subs.add(h)),!B(l))){l.proto.disconnectHooks!==null&&r.push(...l.proto.disconnectHooks);for(let w of l.pubs)L(l.proto,w)}},E=(h,l)=>{if(!l.subs.has(h)){let w=B(l);if(l.subs.add(h),m.push(()=>l.subs.delete(h)),!w){l.proto.connectHooks!==null&&r.push(...l.proto.connectHooks);for(let i of(l.proto.patch??s(l.proto)).pubs)E(l.proto,i)}}},T=(h,l,w)=>{let{patch:i,actual:f}=l,v=w!==void 0;if(!v&&f&&(i.pubs.length===0||B(i)))return i;let A=i??s(l),le=!A,ue=v?h.cause:s(Q);if(le)A={state:l.initState(h),proto:l,cause:ue,pubs:[],subs:new Set,listeners:new Set},v&&p.push(A);else if(l.computer===null&&!v)return A;i&&!f||(i=b(A,ue));let{state:ve}=i,F={get:h.get,spy:void 0,schedule:h.schedule,subscribe:h.subscribe,cause:i};try{l.computer&&((N,M)=>{let{proto:x,pubs:P}=M,de=!1;if(P.length===0||P.some(({proto:D,state:R})=>!Object.is(R,(M.cause=T(N,D)).state))){let D=[];if(N.spy=({__reatom:R},z)=>{let V=T(N,R),X=D.push(V)<=P.length?P[D.length-1]:void 0,Y=X?.proto!==V.proto;de||=Y;let k=R.isAction&&!Y?V.state.slice(X.state.length):V.state;if(!z||!Y&&Object.is(k,X.state))return k;if(R.isAction)for(const ye of k)z(ye);else z(k,Y?void 0:X?.state)},M.state=M.proto.computer(N,M.state),M.pubs=D,(de||P.length>D.length)&&B(M)){for(let{proto:R}of P)D.every(z=>z.proto!==R)&&L(x,R.patch??s(R));for(let{proto:R}of D)P.every(z=>z.proto!==R)&&E(x,R.patch??s(R))}N.spy=()=>$(!0,"async spy"),M=x=P=D=null}})(F,i),v&&(i.cause=h.cause,w(F,i)),l.actual=!0}catch(N){throw i.error=N}if(!Object.is(ve,i.state)&&(i.subs.size>0&&(v||i.listeners.size>0)&&S(i),l.updateHooks)){let N={get:F.get,spy:void 0,schedule:F.schedule,subscribe:F.subscribe,cause:F.cause};l.updateHooks.forEach(M=>g.push(()=>M(N,i)))}return i},I={get(h){if($(J&&pe(J.cause)!==s(Q),"cause collision"),W(h)){let i=h.__reatom;if(u)return T(this,i).state;let f=s(i);return f===void 0||i.computer!==null&&!B(f)?this.get(()=>T(this,i).state):f.state}if($(d!==null,"tr failed"),u)return h(s,T);u=!0,C=r.length,O=a.length;let l=J===void 0;l&&(J=this);try{var w=h(s,T);for(let i=0;i<p.length;i++){let{listeners:f,proto:v}=p[i];if(f.size>0&&T(this,v),g.length>0)for(let A of g.splice(0))A(this)}if(p.length)for(let i of c)i(p);for(let i of p){let{proto:f,state:v}=i;if(f.isAction&&(i.state=[]),i===f.patch)if(f.patch=null,f.actual=!1,o.set(f,i),f.isAction){if(v.length===0)continue;for(let A of i.listeners)r.push(()=>A(v))}else for(let A of i.listeners)a.push(()=>A(s(f).state))}}catch(i){d=i=i instanceof Error?i:new Error(String(i));for(let f of c)f(p,i);for(let f of m)ee(f,i);for(let{proto:f}of p)f.patch=null,f.actual=!1;throw r.length=C,a.length=O,i}finally{u=!1,d=null,g=[],m=[],p=[],C=0,O=0,l&&(J=void 0)}return _(),w},spy:void 0,schedule(h,l=1){return se(h),$(!this,"missed context"),new Promise((w,i)=>{l===-1?u&&m.push(h):l===0?u&&g.push(()=>h(this)):((l===1?r:a).push(()=>{try{let f=h(this);return f instanceof Promise?f.then(w,i):w(f),f}catch(f){throw i(f),f}}),u||_())})},subscribe(h,l=h){if(se(l),h===l)return c.add(l),()=>c.delete(l);$(!W(h),"target subscriber isn't an atom");let{__reatom:w}=h,i=he,f=A=>Object.is(i,A)||l(i=A),v=s(w);return v!==void 0&&B(v)?v.listeners.add(f):this.get(()=>{v=T(this,w,(A,le)=>{}),v.listeners.add(f),m.push(()=>w.patch.listeners.delete(f));for(let A of v.pubs)E(w,A);w.connectHooks!==null&&r.push(...w.connectHooks)}),i===he&&f((w.patch??s(w)).state),()=>{if(v.listeners.delete(f)&&!B(v)){w.disconnectHooks&&r.push(...w.disconnectHooks);for(let A of s(w).pubs)L(w,A);u||(m.length=0,_())}}},cause:void 0};return(I.cause=I.get(()=>T(I,Q))).cause=null,I};let Te=0,ge=e=>`${e}#${++Te}`;function Le(){return[].slice.call(arguments).reduce((e,t)=>t(e),this)}function Re(e){const t=(n,o)=>e(n,o.state);return(this.__reatom.updateHooks??=new Set).add(t),()=>this.__reatom.updateHooks.delete(t)}function je(e){return this.onChange((t,n)=>{const{params:o,payload:s}=n[n.length-1];e(t,s,o)})}function j(e,t=ge("_atom")){let n=(s,c)=>s.get((r,a)=>a(s,n.__reatom,(u,d)=>{d.state=typeof c=="function"?c(d.state,u):c}).state),o=null;return typeof e=="function"&&(n={},o=e,e=void 0),n.__reatom={name:t,isAction:!1,patch:null,initState:()=>e,computer:o,connectHooks:null,disconnectHooks:null,updateHooks:null,actual:!1},n.pipe=Le,n.onChange=Re,fe.length===0?n:n.pipe(...fe)}const _e=(e,t)=>{e!==void 0&&typeof e!="string"||(t=e,e=(o,s)=>s),se(e);let n=j([],t??ge("_action"));return n.__reatom.isAction=!0,n.__reatom.unstable_fn=e,Object.assign(function(){var o=[].slice.call(arguments);let s=n(o[0],(c,r)=>(o[0]=r,[...c,{params:o.slice(1),payload:r.cause.proto.unstable_fn(...o)}]));return s[s.length-1].payload},n,{onCall:je})},fe=[],Q=j(void 0,"root").__reatom,oe=()=>{},He=e=>typeof e=="object"&&e!==null,Ie=Object.assign,Me=function(){return Object.assign({},...[].slice.call(arguments))};let Ne=(e=0,t=Number.MAX_SAFE_INTEGER-1)=>Math.floor(Math.random()*(t-e+1))+e;const De=(e,t)=>Ne(e,t),{toString:$e}=Object.prototype;let Pe=0;const ne=e=>{if(e instanceof Error==0||e.name!=="AbortError"){if(e instanceof Error){var t={cause:e};e=e.message}else e=He(e)?$e.call(e):String(e);e+=` [${++Pe}]`,typeof DOMException>"u"?(e=new Error(e,t)).name="AbortError":e=Ie(new DOMException(e,"AbortError"),t)}return e},me=e=>{if(e?.signal.aborted)throw ne(e.signal.reason)};Object.assign(function(){const e=globalThis.setTimeout(...[].slice.call(arguments));return typeof e=="number"?e:Object.assign(e,{toJSON:()=>-1})},globalThis.setTimeout);const be=2**31-1;function ze(e,t){try{var n=e()}catch(o){return t(o)}return n&&n.then?n.then(void 0,t):n}class Be extends WeakMap{has(t){return super.has(t)||t.cause!==null&&this.has(t.cause)}get(t){for(;!super.has(t)&&t.cause;)t=t.cause;return super.get(t)}}const re=new Be,we=e=>re.get(e)??null,Ue=(e,t)=>{const n=we(e.cause);if(n){const o=()=>t(ne(n.signal.reason)),s=()=>n.signal.removeEventListener("abort",o);if(!n.signal.aborted)return n.signal.addEventListener("abort",o),s;o()}},Fe=e=>{const{schedule:t}=e;return Me(e,{schedule(n,o=1){const s=this;if(o<1)return t.call(this,n,o);let c,r;const a=new Promise((d,g)=>{c=d,r=g}),u=Ue(this,d=>{a.catch(oe),r(d)});return t.call(this,function(d){try{let g=function(){u?.()};const m=ze(function(){const p=we(s.cause);return me(p),Promise.resolve(n(d)).then(function(C){me(p),c(C)})},function(p){r(p)});return Promise.resolve(m&&m.then?m.then(g):g())}catch(g){return Promise.reject(g)}},o).catch(d=>{r(d),u?.()}),a}})};_e(function(e,t,n){return re.set(e.cause,n),t(e,...[].slice.call(arguments,3))},"_spawn");const Z=e=>e.cause===null?e:Z(e.cause),Ge=(e,t)=>Z(e.cause)===Z(t.cause),Je=(e,t)=>(e.__reatom.connectHooks??=new Set).add(t),We=(e,t)=>(e.__reatom.disconnectHooks??=new Set).add(t),Ve=_e((e,t,n,o)=>{e.cause.cause=Z(e.cause),re.set(e.cause,o);const s=n(Fe({...e,controller:o,isConnected:()=>Ye(e,t)}));return s instanceof Promise&&o.signal.addEventListener("abort",()=>s.catch(oe)),s},"_onConnect"),Xe=(e,t)=>{const n=s=>{const c=new AbortController,r=Ve(s,e,t,c);r instanceof Promise&&r.catch(oe);const a=d=>{Ge(s,d)&&u.delete(a)&&o.has(n)&&(c.abort(ne("disconnect "+e.__reatom.name)),typeof r=="function"&&r())},u=We(e,a)},o=Je(e,n);return()=>o.delete(n)},Ye=(e,{__reatom:t})=>e.get(n=>{const o=t.patch??n(t);return!!o&&o.subs.size+o.listeners.size>0}),ke=j(null,"initializations");ke.__reatom.initState=()=>new WeakMap;typeof document<"u"?U.useLayoutEffect:U.useEffect;const{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ke,__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE:Qe}=U,Ze=e=>{let t=Ke?.ReactCurrentOwner?.current?.type??Qe?.A?.getOwner?.()?.type,n=t?.displayName??t?.name;return n?`Component.${n}.${e}`:`_${e}`};let qe=e=>e();const xe=U.createContext(null),et=()=>{let e=U.useContext(xe);return $(!e,"ctx is not set, you probably forgot to specify the ctx provider"),e},lt=(e,t=[],n={})=>{let{name:o,subscribe:s=!0}=typeof n=="boolean"?{subscribe:n}:n,c=et(),r=[c];W(e)&&r.push(e);let a=U.useMemo(()=>{let C=Ze(o??"useAtom#"+typeof e),O=j([],`${C}._depsAtom`),y=e;return W(y)||(y=j(typeof e=="function"?(_,b)=>(_.spy(O),a.anAtom(_,b)):e,C)),{theAtom:y,depsAtom:O,update:typeof y=="function"?function(){return qe(()=>y(c,...[].slice.call(arguments)))}:void 0,sub:_=>c.subscribe(y,_),get:()=>c.get(y),subscribe:s,anAtom:e}},r);a.anAtom=e;let{theAtom:u,depsAtom:d,update:g,sub:m,get:p}=a;return c.get(()=>{if(!W(e)){const C=c.get(d);(t.length!==C.length||t.some((O,y)=>!Object.is(O,C[y])))&&(typeof e=="function"?d(c,t):g(c,e))}return[s?U.useSyncExternalStore(m,p,p):p(),g,u,c]})},G=e=>{const t=j(e,`storageAtom#${e.name}`);return Object.assign(n=>o=>{const{key:s,fromSnapshot:c=(_,b)=>b,migration:r,subscribe:a=!!e.subscribe,time:u=be,toSnapshot:d=(_,b)=>b,version:g=0}=typeof n=="string"?{key:n}:n,m=o.__reatom,{initState:p,isAction:C}=m;$(C,"cannot apply persist to an action");const O=(_,b=null)=>{const S=_.get(t).get(_,s);return S?.id===b?.id?b:S??b},y=(_,b=O(_),S)=>b===null||b.version!==g&&r===void 0?p(_):c(_,b.version!==g?r(_,b):b.data,S);$(!s,"missed key");const H=j(null,`${o.__reatom.name}._${e.name}Atom`);if(H.__reatom.computer=O,a){const{computer:_}=o.__reatom;o.__reatom.computer=(b,S)=>{if(b.spy(H,L=>{S=y(b,L,S)}),_){const{pubs:L}=b.cause;if(L.length===0||L.length>1&&L.some((E,T)=>T!==0&&!Object.is(E.state,b.get({__reatom:E.proto}))))S=_(b,S);else for(let E=1;E<L.length;E++)b.spy({__reatom:L[E].proto})}return S},Xe(o,b=>b.get(t).subscribe?.(b,s,()=>{H(b,S=>S)}))}else o.__reatom.initState=y;return o.onChange((_,b)=>{const{cause:S}=_,L=_.get(T=>T(Q));_.get(H);let E=_.get((T,I)=>I(_,H.__reatom));if(S.cause===E&&E.cause===S&&(E.cause=L),(o.__reatom.patch===S||Object.is(o.__reatom.patch.state,S.state))&&S.cause!==E){const{subs:T}=E;E.subs=new Set;const I=H(_,((l,w)=>({data:d(l,w),fromState:!0,id:De(),timestamp:Date.now(),to:Date.now()+u,version:g}))(_,b));(E=E.proto.patch).subs=E.subs=T,E.cause=L;const h=S.pubs.findIndex(({proto:l})=>l===E.proto);S.pubs[h]=E,_.get(t).set(_,s,I)}}),Object.assign(o,{__persistRecordAtom:H})},{storageAtom:t})},ae=({name:e,mutable:t=!0,snapshot:n={},subscribe:o=!0})=>{const s=Date.now(),c=s+be,r=Object.entries(n).reduce((g,[m,p])=>(g[m]={data:p,fromState:!1,id:0,timestamp:s,to:c,version:0},g),{}),a=j(r,`${e}._snapshotAtom`);a.__reatom.initState=()=>({...r});const u=new Map,d=j(u,`${e}._listenersAtom`);return d.__reatom.initState=()=>new Map(u),{name:e,get:(g,m)=>g.get(a)[m]??null,set:(g,m,p)=>{if(t){const C=g.get(a),O=C[m];C[m]=p,g.schedule(()=>C[m]=O,-1)}else a(g,C=>({...C,[m]:p}));g.schedule(()=>g.get(d).get(m)?.forEach(C=>C(p)))},subscribe:o?(g,m,p)=>{const C=g.get(d);C.set(m,(C.get(m)??new Set).add(p));const O=()=>{const y=C.get(m);y&&(y.delete(p),y.size===0&&C.delete(m))};return g.schedule(O,-1),O}:void 0,snapshotAtom:a}};function q(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function Ce(e,t){let n;const o=()=>{if(n)return n;const s=indexedDB.open(e);return s.onupgradeneeded=()=>s.result.createObjectStore(t),n=q(s),n.then(c=>{c.onclose=()=>n=void 0},()=>{}),n};return(s,c)=>o().then(r=>c(r.transaction(t,s).objectStore(t)))}let te;function ie(){return te||(te=Ce("keyval-store","keyval")),te}function tt(e,t=ie()){return t("readonly",n=>q(n.get(e)))}function st(e,t,n=ie()){return n("readwrite",o=>(o.put(t,e),q(o.transaction)))}function ot(e,t=ie()){return t("readwrite",n=>(n.delete(e),q(n.transaction)))}const nt=e=>{const t=o=>e.postMessage(o),n=j((o,s=new Map)=>s,"withBroadcastChannel._memCacheAtom");return G({name:"withBroadcastChannel",get(o,s){return o.get(n).get(s)??null},set(o,s,c){o.get(n).set(s,c),o.schedule(()=>t({key:s,rec:c,_type:"push"}))},clear(o,s){o.get(n).delete(s),o.schedule(()=>t({key:s,rec:null,_type:"push"}))},subscribe(o,s,c){const r=o.get(n),a=u=>{if(u.data?.key===s){if(u.data._type==="pull"){const d=r.get(s);d&&o.schedule(()=>t({_type:"push",key:s,rec:d}))}else if(u.data._type==="push"){const{rec:d}=u.data;d===null?r.delete(s):d.id!==r.get(s)?.id&&(r.set(s,d),c())}}};return e.addEventListener("message",a,!1),r.has(s)||o.schedule(()=>t({_type:"pull",key:s})),()=>e.removeEventListener("message",a,!1)}})};try{var Se=!!globalThis.BroadcastChannel}catch{Se=!1}Se?new BroadcastChannel("reatom_withBroadcastChannel_default"):ae({name:"withBroadcastChannel"});const K={get:tt,set:st,del:ot,createStore:Ce},rt=(e,t)=>{const n=r=>t.postMessage(r),o=j((r,a=new Map)=>a,"withIndexedDb._memCacheAtom");let s;const c=()=>s??=K.createStore(e,"atoms");return G({name:"withIndexedDb",get(r,a){return r.get(o).get(a)??null},set(r,a,u){r.get(o).set(a,u),r.schedule(async()=>{await K.set(a,u,c()),n({key:a,rec:u,_type:"push"})})},clear(r,a){r.get(o).delete(a),r.schedule(async()=>{await K.del(a,c()),n({key:a,rec:null,_type:"push"})})},subscribe(r,a,u){const d=r.get(o),g=m=>{if(m.data.key===a){if(m.data._type==="pull"&&d.has(a))r.schedule(()=>n({_type:"push",key:a,rec:d.get(a)}));else if(m.data._type==="push"){const{rec:p}=m.data;p===null?d.delete(a):p.id!==d.get(a)?.id&&(d.set(a,p),u())}}};return t.addEventListener("message",g),d.has(a)||r.schedule(async m=>{const p=await K.get(a,c()),C=m.get(o);p.id!==C.get(a)?.id&&(C.set(a,p),u())}),()=>t.removeEventListener("message",g)}})};new BroadcastChannel("reatom_withIndexedDb_default");const Ee=(e,t)=>{const n=j((o,s=new Map)=>s,`${e}._memCacheAtom`);return G({name:e,get(o,s){try{const c=o.get(n),r=t.getItem(s);if(r){const a=JSON.parse(r);if(a.to<Date.now())return this.clear(o,s),null;const u=c.get(s);return u?.id===a.id||u?.timestamp>=a.timestamp?u:(c.set(s,a),a)}}catch{return null}return null},set(o,s,c){o.get(n).set(s,c),o.schedule(()=>t.setItem(s,JSON.stringify(c)))},clear(o,s){o.get(n).delete(s),o.schedule(()=>t.removeItem(s))},subscribe(o,s,c){const r=o.get(n),a=u=>{if(u.storageArea===t&&u.key===s)if(u.newValue===null)r.delete(s);else{const d=JSON.parse(u.newValue);d.id!==r.get(s)?.id&&(r.set(s,d),c())}};return globalThis.addEventListener?.("storage",a,!1),()=>globalThis.removeEventListener?.("storage",a,!1)}})};try{var ce=!!globalThis.localStorage}catch{ce=!1}const ut=ce?Ee("withLocalStorage",globalThis.localStorage):G(ae({name:"withLocalStorage"}));ce?globalThis.sessionStorage:ae({name:"withSessionStorage"});try{var at="cookie"in globalThis.document}catch{at=!1}export{j as a,_e as b,ct as c,xe as r,lt as u,ut as w};
